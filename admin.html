<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>RightClick Admin Panel</title>
  <link rel="stylesheet" href="style.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<h2>RightClick Computer Sales & Service Center</h2>
<h3>Admin Panel - Job Status Tracker</h3>

<input type="text" id="searchInput" placeholder="Search by Job ID or Customer Name">

<table border="1" id="jobsTable">
  <thead>
    <tr>
      <th>Job ID</th>
      <th>Customer Name</th>
      <th>Mobile</th>
      <th>Item</th>
      <th>Status</th>
      <th>Update Status</th>
    </tr>
  </thead>
  <tbody id="jobsBody">
    <!-- Jobs will appear here -->
  </tbody>
</table>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getFirestore, collection, getDocs, doc, updateDoc } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyB8uRXxvOyZeCUzPEt-pUytXj_R8N_JLww",
  authDomain: "rightclick-service-center.firebaseapp.com",
  projectId: "rightclick-service-center",
  storageBucket: "rightclick-service-center.firebasestorage.app",
  messagingSenderId: "558210394752",
  appId: "1:558210394752:web:a3f8663d7c6dc8cc88d465"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const jobsBody = document.getElementById("jobsBody");
const searchInput = document.getElementById("searchInput");

async function loadJobs() {
  jobsBody.innerHTML = "";
  const querySnapshot = await getDocs(collection(db, "jobs"));
  querySnapshot.forEach(docSnap => {
    const job = docSnap.data();
    const row = document.createElement("tr");

    row.innerHTML = `
      <td>${job.jobId}</td>
      <td>${job.customerName}</td>
      <td>${job.mobile}</td>
      <td>${job.item}</td>
      <td id="status-${docSnap.id}">${job.status}</td>
      <td>
        <select id="select-${docSnap.id}">
          <option value="Received" ${job.status==="Received"?"selected":""}>Received</option>
          <option value="In Progress" ${job.status==="In Progress"?"selected":""}>In Progress</option>
          <option value="Ready" ${job.status==="Ready"?"selected":""}>Ready</option>
          <option value="Delivered" ${job.status==="Delivered"?"selected":""}>Delivered</option>
        </select>
        <button onclick="updateStatus('${docSnap.id}')">Update</button>
      </td>
    `;
    jobsBody.appendChild(row);
  });
}

window.updateStatus = async function(docId) {
  const select = document.getElementById(`select-${docId}`);
  const newStatus = select.value;
  const docRef = doc(db, "jobs", docId);
  await updateDoc(docRef, { status: newStatus });
  document.getElementById(`status-${docId}`).innerText = newStatus;
  alert("Status updated to: " + newStatus);
}

// Search functionality
searchInput.addEventListener("input", () => {
  const filter = searchInput.value.toLowerCase();
  const rows = jobsBody.getElementsByTagName("tr");
  for (let i=0; i<rows.length; i++) {
    const cells = rows[i].getElementsByTagName("td");
    let show = false;
    for (let j=0; j<2; j++) { // check Job ID and Customer Name
      if (cells[j].innerText.toLowerCase().includes(filter)) {
        show = true;
        break;
      }
    }
    rows[i].style.display = show ? "" : "none";
  }
});

loadJobs();

</script>

</body>
</html>
