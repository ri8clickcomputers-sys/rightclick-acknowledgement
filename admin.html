<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>RightClick Admin Panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:Roboto;background:#f5f8fb;margin:0}
header{background:#003366;color:white;text-align:center;padding:15px}
#jobs{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:15px;padding:20px}
.card{background:white;padding:15px;border-radius:10px;box-shadow:0 4px 10px rgba(0,0,0,.1)}
button{background:#003366;color:white;border:none;padding:6px 12px;border-radius:6px}
</style>
</head>
<body>

<header>
<h2>RightClick Admin Panel</h2>
</header>

<div id="jobs"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getFirestore, collection, getDocs, doc, updateDoc, getDoc } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

const firebaseConfig = {
 apiKey: "AIzaSyB8uRXxvOyZeCUzPEt-pUytXj_R8N_JLww",
 authDomain: "rightclick-service-center.firebaseapp.com",
 projectId: "rightclick-service-center",
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

async function loadJobs(){
 const container=document.getElementById("jobs");
 container.innerHTML="";
 const snap=await getDocs(collection(db,"jobs"));
 snap.forEach(d=>{
  const j=d.data();
  const div=document.createElement("div");
  div.className="card";
  div.innerHTML=`
   <h4>${j.jobId}</h4>
   <p>${j.customerName}</p>
   <p>${j.item}</p>
   <select id="s-${d.id}">
    <option ${j.status=="Received"?"selected":""}>Received</option>
    <option ${j.status=="In Progress"?"selected":""}>In Progress</option>
    <option ${j.status=="Ready"?"selected":""}>Ready</option>
    <option ${j.status=="Delivered"?"selected":""}>Delivered</option>
   </select>
   <button onclick="updateStatus('${d.id}')">Update</button>
  `;
  container.appendChild(div);
 });
}

window.updateStatus = async(id)=>{
 const sel=document.getElementById(`s-${id}`);
 const newStatus=sel.value;
 const ref=doc(db,"jobs",id);
 await updateDoc(ref,{status:newStatus});
 const snap=await getDoc(ref);
 const j=snap.data();

 let number=j.mobile;
 if(!number.startsWith("91")) number="91"+number;

 const msg = encodeURIComponent(
`RightClick Computer Sales & Service Center
Your device status has been updated.
Job ID: ${j.jobId}
Status: ${newStatus}
Thank you.`
 );

 window.open(`https://wa.me/${number}?text=${msg}`,"_blank");
 alert("Updated & WhatsApp Sent");
 loadJobs();
}

loadJobs();
</script>
</body>
</html>
